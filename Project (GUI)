import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.sql.*;

public class FoodOrderGUI {
    private int total = 0;
    private Connection connection;

    private JComboBox<String> foodCategory;
    private JComboBox<String> itemMenu;
    private JTextField quantityField;
    private JTextArea orderSummary;
    private JTextField customerNameField;
    private JTextField contactField;
    private JLabel totalLabel;

    public FoodOrderGUI() {
        setLookAndFeel();
        connectToDatabase();

        JFrame frame = new JFrame("Cafe Menu");
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setSize(600, 700);
        frame.setLayout(new BorderLayout());

        JLabel logo = new JLabel(new ImageIcon("logo.png"));
        frame.add(logo, BorderLayout.NORTH);

        JPanel inputPanel = new JPanel(new GridBagLayout());
        GridBagConstraints gbc = new GridBagConstraints();
        gbc.insets = new Insets(5, 5, 5, 5);
        gbc.fill = GridBagConstraints.HORIZONTAL;

        foodCategory = new JComboBox<>(new String[]{
                "Select Category", "Fries", "Burgers (Veg)", "Burgers (Non-Veg)",
                "Pizzas (Veg)", "Pizzas (Non-Veg)", "Salads", "Drips (Sauces)", 
                "Drinks", "Desserts"
        });

        itemMenu = new JComboBox<>();
        quantityField = new JTextField(5);
        orderSummary = new JTextArea(10, 30);
        orderSummary.setEditable(false);
        customerNameField = new JTextField(15);
        contactField = new JTextField(15);
        totalLabel = new JLabel("Total: $0");

        JButton addButton = new JButton("Add to Order");
        JButton generateBillButton = new JButton("Generate Bill");
        JButton saveOrderButton = new JButton("Save Order");

        foodCategory.addActionListener(e -> updateItemMenu());
        addButton.addActionListener(e -> addToOrder());
        generateBillButton.addActionListener(e -> generateBill());
        saveOrderButton.addActionListener(e -> saveOrder());

        gbc.gridx = 0;
        gbc.gridy = 0;
        inputPanel.add(new JLabel("Customer Name:"), gbc);
        gbc.gridx = 1;
        inputPanel.add(customerNameField, gbc);

        gbc.gridx = 0;
        gbc.gridy = 1;
        inputPanel.add(new JLabel("Contact Info:"), gbc);
        gbc.gridx = 1;
        inputPanel.add(contactField, gbc);

        gbc.gridx = 0;
        gbc.gridy = 2;
        inputPanel.add(new JLabel("Category:"), gbc);
        gbc.gridx = 1;
        inputPanel.add(foodCategory, gbc);

        gbc.gridx = 0;
        gbc.gridy = 3;
        inputPanel.add(new JLabel("Menu Item:"), gbc);
        gbc.gridx = 1;
        inputPanel.add(itemMenu, gbc);

        gbc.gridx = 0;
        gbc.gridy = 4;
        inputPanel.add(new JLabel("Quantity:"), gbc);
        gbc.gridx = 1;
        inputPanel.add(quantityField, gbc);

        gbc.gridx = 0;
        gbc.gridy = 5;
        inputPanel.add(addButton, gbc);
        gbc.gridx = 1;
        inputPanel.add(generateBillButton, gbc);
        gbc.gridx = 2;
        inputPanel.add(saveOrderButton, gbc);

        frame.add(inputPanel, BorderLayout.CENTER);

        JPanel orderPanel = new JPanel(new BorderLayout());
        orderPanel.add(new JScrollPane(orderSummary), BorderLayout.CENTER);
        orderPanel.add(totalLabel, BorderLayout.SOUTH);
        frame.add(orderPanel, BorderLayout.SOUTH);

        JMenuBar menuBar = new JMenuBar();
        JMenu helpMenu = new JMenu("Help");
        JMenuItem aboutItem = new JMenuItem("About");
        aboutItem.addActionListener(e -> JOptionPane.showMessageDialog(frame, "Food Order Application v1.0\nDeveloped by [Your Name]"));
        helpMenu.add(aboutItem);
        menuBar.add(helpMenu);
        frame.setJMenuBar(menuBar);

        frame.setVisible(true);
    }

    private void setLookAndFeel() {
        try {
            UIManager.setLookAndFeel("javax.swing.plaf.nimbus.NimbusLookAndFeel");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    private void connectToDatabase() {
        try {
            String url = "jdbc:mysql://localhost:3306/cafe";
            String user = "root";
            String password = "";
            connection = DriverManager.getConnection(url, user, password);
            JOptionPane.showMessageDialog(null, "Connected to MySQL Database!");
        } catch (SQLException e) {
            JOptionPane.showMessageDialog(null, "Database connection error: " + e.getMessage());
        }
    }

    private void updateItemMenu() {
        itemMenu.removeAllItems();
        String selectedCategory = (String) foodCategory.getSelectedItem();
        if ("Fries".equals(selectedCategory)) {
            itemMenu.addItem("Regular Fries - 2");
            itemMenu.addItem("Cheese Fries - 3");
        } else if ("Burgers (Veg)".equals(selectedCategory)) {
            itemMenu.addItem("Veggie Burger - 5");
            itemMenu.addItem("Tofu Burger - 6");
        }
        // Add other categories similarly...
    }

    private void addToOrder() {
        String selectedItem = (String) itemMenu.getSelectedItem();
        int quantity;
        try {
            quantity = Integer.parseInt(quantityField.getText());
        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(null, "Please enter a valid quantity.");
            return;
        }
        if (selectedItem != null && quantity > 0) {
            String[] parts = selectedItem.split(" - ");
            String itemName = parts[0];
            int itemPrice = Integer.parseInt(parts[1]);
            total += itemPrice * quantity;
            orderSummary.append(quantity + " x " + itemName + " = " + (itemPrice * quantity) + "\n");
            totalLabel.setText("Total: $" + total);
            quantityField.setText("");
        } else {
            JOptionPane.showMessageDialog(null, "Please select an item and enter a valid quantity.");
        }
    }

    private void generateBill() {
        if (total > 0) {
            JOptionPane.showMessageDialog(null, "Total Bill: $" + total);
            orderSummary.setText("");
            totalLabel.setText("Total: $0");
            total = 0;
        } else {
            JOptionPane.showMessageDialog(null, "No items ordered yet.");
        }
    }

    private void saveOrder() {
        String customerName = customerNameField.getText();
        String contactInfo = contactField.getText();
        if (customerName.isEmpty() || contactInfo.isEmpty() || total <= 0) {
            JOptionPane.showMessageDialog(null, "Please provide customer details and add items to the order.");
            return;
        }
        try {
            String sqlInsertCustomer = "INSERT INTO customers (name, contact_info) VALUES (?, ?)";
            PreparedStatement pstmtCustomer = connection.prepareStatement(sqlInsertCustomer, PreparedStatement.RETURN_GENERATED_KEYS);
            pstmtCustomer.setString(1, customerName);
            pstmtCustomer.setString(2, contactInfo);
            pstmtCustomer.executeUpdate();

            ResultSet generatedKeys = pstmtCustomer.getGeneratedKeys();
            int customerId = -1;
            if (generatedKeys.next()) {
                customerId = generatedKeys.getInt(1);
            }
            for (String line : orderSummary.getText().split("\n")) {
                String[] parts = line.split(" = ");
                String[] itemParts = parts[0].split(" x ");
                String itemName = itemParts[1];
                int quantity = Integer.parseInt(itemParts[0]);
                double itemTotal = Double.parseDouble(parts[1]);
                String sqlInsertOrder = "INSERT INTO orders (customer_id, item_name, quantity, total_price) VALUES (?, ?, ?, ?)";
                PreparedStatement pstmtOrder = connection.prepareStatement(sqlInsertOrder);
                pstmtOrder.setInt(1, customerId);
                pstmtOrder.setString(2, itemName);
                pstmtOrder.setInt(3, quantity);
                pstmtOrder.setDouble(4, itemTotal);
                pstmtOrder.executeUpdate();
            }
            JOptionPane.showMessageDialog(null, "Order saved successfully!");
            orderSummary.setText("");
            totalLabel.setText("Total: $0");
            total = 0;
            customerNameField.setText("");
            contactField.setText("");
        } catch (SQLException e) {
            JOptionPane.showMessageDialog(null, "Error saving order: " + e.getMessage());
        }
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(FoodOrderGUI::new);
    }
}